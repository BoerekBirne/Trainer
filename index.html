<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physik Trainer Pro</title>
    <style>
        /* --- DESIGN VARIABLES --- */
        :root {
            --bg-body: #f8f9fa;
            --bg-card: #ffffff;
            --text-main: #212529;
            --text-muted: #6c757d;
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --error: #c0392b;
            --border: #dee2e6;
            --shadow: 0 2px 10px rgba(0,0,0,0.05);
            --font-stack: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        .dark-mode {
            --bg-body: #121212;
            --bg-card: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --primary: #4a6fa5;
            --accent: #64b5f6;
            --border: #333;
            --shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* --- BASIC RESET & TYPO --- */
        * { box-sizing: border-box; }
        body {
            font-family: var(--font-stack);
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            transition: background 0.3s, color 0.3s;
            line-height: 1.6;
        }

        h1, h2, h3 { margin-top: 0; color: var(--primary); }
        
        /* --- LAYOUT --- */
        header {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 60px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
        }

        .brand { font-weight: 700; font-size: 1.1rem; letter-spacing: 0.5px; }
        
        button { cursor: pointer; border: none; outline: none; font-family: inherit; }
        
        .icon-btn {
            background: none;
            font-size: 1.2rem;
            color: var(--text-main);
            padding: 8px;
            border-radius: 4px;
        }
        .icon-btn:hover { background: rgba(0,0,0,0.05); }

        .header-controls { display: flex; align-items: center; gap: 10px; }
        .lang-btn { font-size: 0.9rem; font-weight: bold; border: 1px solid var(--border); padding: 5px 10px; border-radius: 4px; }

        /* --- SIDE MENU --- */
        #side-menu {
            position: fixed;
            top: 60px; left: -300px;
            width: 300px;
            height: calc(100vh - 60px);
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            padding: 20px;
            transition: left 0.3s ease;
            z-index: 999;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        #side-menu.open { left: 0; }

        .search-container { margin-bottom: 20px; }
        #search-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            background: var(--bg-body);
            color: var(--text-main);
            border-radius: 4px;
        }

        .menu-group { margin-bottom: 20px; }
        .menu-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .menu-item {
            display: block;
            padding: 12px;
            margin-bottom: 5px;
            border-radius: 6px;
            background: transparent;
            text-align: left;
            width: 100%;
            color: var(--text-main);
            font-weight: 500;
            transition: background 0.2s;
            border: 1px solid transparent;
        }
        .menu-item:hover {
            background: rgba(52, 152, 219, 0.1);
            color: var(--accent);
            border-color: rgba(52, 152, 219, 0.2);
        }

        /* --- MAIN CONTENT --- */
        main {
            margin-top: 60px;
            padding: 30px 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        /* --- QUIZ UI --- */
        .progress-container {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            margin-bottom: 25px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.4s ease;
        }

        .question-text {
            font-size: 1.3rem;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        @media(min-width: 600px) { .options-grid { grid-template-columns: 1fr 1fr; } }

        .btn-option {
            padding: 15px;
            background: var(--bg-body);
            border: 2px solid var(--border);
            border-radius: 6px;
            color: var(--text-main);
            font-size: 1rem;
            transition: all 0.2s;
        }
        .btn-option:hover:not(:disabled) {
            border-color: var(--accent);
            background: rgba(52, 152, 219, 0.05);
        }
        .btn-option.correct {
            border-color: var(--success);
            background: rgba(39, 174, 96, 0.1);
            color: var(--success);
        }
        .btn-option.wrong {
            border-color: var(--error);
            background: rgba(192, 57, 43, 0.1);
            color: var(--error);
        }

        .input-field {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid var(--border);
            border-radius: 6px;
            background: var(--bg-body);
            color: var(--text-main);
            margin-bottom: 15px;
        }
        
        .feedback-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-size: 0.95rem;
            display: none;
        }
        .feedback-box.show { display: block; animation: fadeIn 0.3s; }
        
        .controls {
            margin-top: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            padding: 12px 24px;
            border-radius: 6px;
            font-weight: 600;
        }
        .btn-primary:hover { opacity: 0.9; }
        
        .btn-secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 10px 20px;
            border-radius: 6px;
        }
        .btn-secondary:hover { border-color: var(--text-main); color: var(--text-main); }

        .hidden { display: none !important; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <header>
        <button class="icon-btn" onclick="toggleMenu()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
        <div class="brand" id="txt-brand">Physik Trainer Pro</div>
        <div class="header-controls">
            <button class="icon-btn lang-btn" onclick="toggleLang()" id="lang-btn">EN</button>
            <button class="icon-btn" onclick="toggleTheme()">
                <svg id="theme-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </button>
        </div>
    </header>

    <nav id="side-menu">
        <div class="search-container">
            <input type="text" id="search-input" placeholder="Themen filtern..." onkeyup="filterMenu()">
        </div>

        <div class="menu-group">
            <div class="menu-label" id="txt-menu1">Lernmethoden</div>
            <button class="menu-item" onclick="startQuiz('mc')" id="btn-mc">üìù Multiple Choice (20+)</button>
            <button class="menu-item" onclick="startQuiz('bool')" id="btn-bool">‚öñÔ∏è Ja / Nein (20+)</button>
            <button class="menu-item" onclick="startQuiz('match')" id="btn-match">üîó Formel-Chaos (20+)</button>
            <button class="menu-item" onclick="startQuiz('fill')" id="btn-fill">‚úçÔ∏è L√ºckentext (20+)</button>
        </div>

        <div class="menu-group">
            <div class="menu-label" id="txt-menu2">Herausforderung</div>
            <button class="menu-item" onclick="startQuiz('calc')" id="btn-calc">üßÆ Mathe-Profi (Unendlich)</button>
        </div>
    </nav>

    <main>
        <div id="start-screen" class="card">
            <h2 id="txt-welcome-head">Willkommen zur√ºck.</h2>
            <p id="txt-welcome-body">W√§hle im Men√º eine Kategorie. Alle Aufgaben basieren auf deinem Physik-Spickzettel. Wir decken ab:</p>
            <ul style="color: var(--text-muted); font-size: 0.9rem;" id="txt-topics">
                <li>Das Ohmsche Gesetz (U, R, I)</li>
                <li>Elektrische Leistung & Energie</li>
                <li>Reihen- & Parallelschaltung</li>
                <li>Spezifischer Widerstand</li>
            </ul>
        </div>

        <div id="quiz-interface" class="card hidden">
            <div class="progress-container">
                <div class="progress-fill" id="progress-bar"></div>
            </div>

            <div class="quiz-header">
                <span style="font-size: 0.8rem; text-transform: uppercase; color: var(--accent); font-weight: bold;" id="quiz-category-label">Kategorie</span>
                <h3 id="question-text" class="question-text">Frage l√§dt...</h3>
            </div>

            <div id="interaction-area"></div>

            <div id="feedback" class="feedback-box"></div>

            <div class="controls">
                <button class="btn-secondary" onclick="showHint()" id="hint-btn">Tipp anzeigen</button>
                <button class="btn-primary hidden" onclick="nextQuestion()" id="next-btn">N√§chste Frage</button>
                <button class="btn-primary hidden" onclick="checkInputAnswer()" id="check-btn">Pr√ºfen</button>
            </div>
        </div>

        <div id="result-screen" class="card hidden" style="text-align: center;">
            <h2 id="txt-res-head">Zusammenfassung</h2>
            <div style="font-size: 3rem; font-weight: bold; margin: 20px 0; color: var(--primary);" id="final-score">0/20</div>
            <p id="result-message" style="margin-bottom: 30px;"></p>
            <button class="btn-primary" onclick="location.reload()" id="btn-restart">Zur√ºck zum Men√º</button>
        </div>
    </main>

    <script>
        // --- TRANSLATION DATA ---
        let currentLang = 'de';
        
        const uiText = {
            de: {
                brand: "Physik Trainer Pro",
                menu1: "Lernmethoden", menu2: "Herausforderung",
                btnMC: "üìù Multiple Choice (20+)", btnBool: "‚öñÔ∏è Ja / Nein (20+)", 
                btnMatch: "üîó Formel-Chaos (20+)", btnFill: "‚úçÔ∏è L√ºckentext (20+)", btnCalc: "üßÆ Mathe-Profi (Unendlich)",
                search: "Themen filtern...",
                welcHead: "Willkommen zur√ºck.",
                welcBody: "W√§hle im Men√º eine Kategorie. Alle Aufgaben basieren auf deinem Physik-Spickzettel. Wir decken ab:",
                topics: "<li>Das Ohmsche Gesetz (U, R, I)</li><li>Elektrische Leistung & Energie</li><li>Reihen- & Parallelschaltung</li><li>Spezifischer Widerstand</li>",
                hint: "Tipp anzeigen", next: "N√§chste Frage", check: "Pr√ºfen",
                resHead: "Zusammenfassung", restart: "Zur√ºck zum Men√º",
                correct: "Richtig!", wrong: "Falsch.",
                resMsg1: "Perfekt! Du hast alles gemeistert.", resMsg2: "Sehr gut! Du bist fit f√ºr die Arbeit.",
                resMsg3: "Ganz okay, aber √ºbe noch ein bisschen.", resMsg4: "Das war noch nichts. Schau dir den Spickzettel nochmal genau an.",
                phText: "Antwort...", phNum: "Zahl eingeben...",
                boolY: "Ja / Richtig", boolN: "Nein / Falsch"
            },
            en: {
                brand: "Physics Trainer Pro",
                menu1: "Learning Methods", menu2: "Challenge",
                btnMC: "üìù Multiple Choice (20+)", btnBool: "‚öñÔ∏è True / False (20+)", 
                btnMatch: "üîó Formula Match (20+)", btnFill: "‚úçÔ∏è Fill in the Blank (20+)", btnCalc: "üßÆ Math Pro (Infinite)",
                search: "Filter topics...",
                welcHead: "Welcome back.",
                welcBody: "Select a category from the menu. All tasks are based on your physics cheat sheet. We cover:",
                topics: "<li>Ohm's Law (V, R, I)</li><li>Electric Power & Energy</li><li>Series & Parallel Circuits</li><li>Specific Resistance</li>",
                hint: "Show Hint", next: "Next Question", check: "Check",
                resHead: "Summary", restart: "Back to Menu",
                correct: "Correct!", wrong: "Wrong.",
                resMsg1: "Perfect! You mastered everything.", resMsg2: "Very good! You are ready for work.",
                resMsg3: "Okay, but practice a bit more.", resMsg4: "Not quite. Check the cheat sheet again.",
                phText: "Answer...", phNum: "Enter number...",
                boolY: "Yes / True", boolN: "No / False"
            }
        };

        // --- DATA POOL (DEUTSCH) ---
        const poolMC_de = [
            { q: "Was besagt das Ohmsche Gesetz?", options: ["U = R ¬∑ I", "U = R / I", "I = R ¬∑ U", "R = U ¬∑ I"], a: 0, hint: "Spannung = Widerstand mal Stromst√§rke." },
            { q: "Welches Formelzeichen steht f√ºr die elektrische Ladung?", options: ["Q", "C", "L", "I"], a: 0, hint: "Denke an 'Quantity' oder Coulomb." },
            { q: "In welcher Einheit wird der elektrische Widerstand gemessen?", options: ["Ohm (Œ©)", "Volt (V)", "Ampere (A)", "Watt (W)"], a: 0, hint: "Das Symbol sieht aus wie ein Hufeisen." },
            { q: "Was gilt in einer Reihenschaltung f√ºr die Stromst√§rke I?", options: ["Ist √ºberall gleich", "Addiert sich", "Ist null", "Teilt sich auf"], a: 0, hint: "Es gibt nur einen Weg f√ºr die Elektronen." },
            { q: "Wie verh√§lt sich die Spannung in einer Parallelschaltung?", options: ["Ist √ºberall gleich", "Addiert sich zur Gesamtspannung", "Ist abh√§ngig vom Widerstand", "Ist immer 230V"], a: 0, hint: "Alle Bauteile h√§ngen direkt an der Quelle." },
            { q: "Die Formel P = U ¬∑ I berechnet welche Gr√∂√üe?", options: ["Elektrische Leistung", "Elektrische Arbeit", "Widerstand", "Spannung"], a: 0, hint: "P steht f√ºr Power." },
            { q: "Was ist die Einheit der elektrischen Energie?", options: ["Joule (Ws)", "Watt (W)", "Volt (V)", "Ampere (A)"], a: 0, hint: "Leistung mal Zeit." },
            { q: "Wie berechnet man den Gesamtwiderstand in Reihe?", options: ["R1 + R2", "1/R1 + 1/R2", "R1 ¬∑ R2", "R1 - R2"], a: 0, hint: "Einfach addieren." },
            { q: "Was bedeutet das Formelzeichen 'œÅ' (Rho)?", options: ["Spezifischer Widerstand", "Dichte", "Radius", "Leistung"], a: 0, hint: "Materialkonstante f√ºr den Widerstand." },
            { q: "Welche Gr√∂√üe wird in Ampere (A) angegeben?", options: ["Stromst√§rke", "Spannung", "Ladung", "Energie"], a: 0, hint: "Der Fluss der Elektronen." },
            { q: "Wie lautet die Formel f√ºr Widerstand mit Drahtl√§nge?", options: ["R = œÅ ¬∑ l / A", "R = œÅ ¬∑ A / l", "R = l ¬∑ A / œÅ", "R = U / P"], a: 0, hint: "Je l√§nger, desto mehr Widerstand. Je dicker, desto weniger." },
            { q: "Was passiert mit dem Gesamtwiderstand bei Parallelschaltung?", options: ["Er wird kleiner als der kleinste Einzelwiderstand", "Er addiert sich", "Er verdoppelt sich", "Er bleibt gleich"], a: 0, hint: "Mehr Wege bedeuten einfacheren Fluss." },
            { q: "Die Formel I = Q / t beschreibt...", options: ["Stromst√§rke als Ladung pro Zeit", "Spannung als Energie pro Ladung", "Leistung als Arbeit pro Zeit", "Widerstand"], a: 0, hint: "Wie viele Elektronen flie√üen pro Sekunde?" },
            { q: "Was ist 1 kŒ© in Ohm?", options: ["1000 Œ©", "100 Œ©", "10 Œ©", "10000 Œ©"], a: 0, hint: "k steht f√ºr Kilo." },
            { q: "Welche Formel f√ºr Leistung ist korrekt?", options: ["P = I¬≤ ¬∑ R", "P = U / R", "P = R / I¬≤", "P = U ¬∑ R"], a: 0, hint: "Setze U=R¬∑I in P=U¬∑I ein." },
            { q: "U = P / I ist eine Umstellung der...", options: ["Leistungsformel", "Widerstandsformel", "Energieformel", "Ladungsformel"], a: 0, hint: "P = U ¬∑ I nach U aufgel√∂st." },
            { q: "Wof√ºr steht 't' in den Formeln?", options: ["Zeit", "Temperatur", "Ton", "Tesla"], a: 0, hint: "Time (in Sekunden)." },
            { q: "Was ist die Formel f√ºr elektrische Arbeit?", options: ["E = P ¬∑ t", "E = U / t", "E = R ¬∑ I", "E = Q / U"], a: 0, hint: "Energie ist Leistung √ºber Zeit." },
            { q: "In einer Reihenschaltung von zwei gleichen Lampen...", options: ["teilt sich die Spannung auf beide auf", "leuchten beide heller als eine einzelne", "flie√üt unterschiedlicher Strom", "ist die Spannung √ºberall gleich"], a: 0, hint: "U_ges = U1 + U2." },
            { q: "Der Querschnitt A eines Leiters wird angegeben in...", options: ["mm¬≤", "m", "cm", "Œ©"], a: 0, hint: "Es ist eine Fl√§che." }
        ];

        const poolBool_de = [
            { q: "In der Parallelschaltung ist die Spannung an allen Widerst√§nden gleich.", a: true, hint: "U_ges = U1 = U2" },
            { q: "Die Einheit der elektrischen Spannung ist Watt.", a: false, hint: "Spannung wird in Volt gemessen." },
            { q: "Der Gesamtwiderstand in Reihe ist die Summe der Einzelwiderst√§nde.", a: true, hint: "R_ges = R1 + R2 + ..." },
            { q: "Stromst√§rke wird in Volt gemessen.", a: false, hint: "Ampere ist richtig." },
            { q: "Elektrische Arbeit E berechnet sich aus Leistung mal Zeit.", a: true, hint: "E = P ¬∑ t" },
            { q: "Ein dickerer Draht (gr√∂√üeres A) hat einen h√∂heren Widerstand.", a: false, hint: "Mehr Platz f√ºr Elektronen = weniger Widerstand." },
            { q: "Kupfer hat einen spezifischen Widerstand.", a: true, hint: "Jedes Material leitet anders." },
            { q: "I = U / R ist eine Form des Ohmschen Gesetzes.", a: true, hint: "Ja, nach I umgestellt." },
            { q: "In einer Reihenschaltung addieren sich die Stromst√§rken.", a: false, hint: "Der Strom muss √ºberall durch." },
            { q: "P = U¬≤ / R ist eine korrekte Leistungsformel.", a: true, hint: "Durch Einsetzen hergeleitet." },
            { q: "Die elektrische Ladung hat das Formelzeichen Q.", a: true, hint: "Korrekt." },
            { q: "Wenn man die Spannung erh√∂ht (bei gleichem R), sinkt der Strom.", a: false, hint: "Mehr Druck (U) = mehr Fluss (I)." },
            { q: "1 Wattsekunde (Ws) entspricht 1 Joule.", a: true, hint: "Das ist die Definition." },
            { q: "Der Kehrwert des Gesamtwiderstands in Parallel ist die Summe der Kehrwerte.", a: true, hint: "1/Rges = 1/R1 + 1/R2" },
            { q: "L√§nge des Leiters hat keinen Einfluss auf den Widerstand.", a: false, hint: "Je l√§nger, desto anstrengender f√ºr Elektronen." },
            { q: "Ein Voltmeter wird immer in Reihe geschaltet.", a: false, hint: "Spannung misst man parallel." },
            { q: "Ein Amperemeter wird in Reihe geschaltet.", a: true, hint: "Der Strom muss durch das Messger√§t flie√üen." },
            { q: "E = U ¬∑ Q ist eine Formel f√ºr Energie.", a: true, hint: "Siehe Spickzettel unten links." },
            { q: "Spezifischer Widerstand wird in Œ©m oder Œ©mm¬≤/m angegeben.", a: true, hint: "Materialabh√§ngig." },
            { q: "Bei unterbrochenem Stromkreis flie√üt trotzdem Strom.", a: false, hint: "Logisch, oder?" }
        ];

        const poolMatch_de = [
            { q: "Gesuchte Gr√∂√üe: U (Spannung)", options: ["R ¬∑ I", "P ¬∑ t", "Q / t", "œÅ ¬∑ l"], a: 0 },
            { q: "Gesuchte Gr√∂√üe: P (Leistung)", options: ["U ¬∑ I", "U / I", "R ¬∑ t", "E / U"], a: 0 },
            { q: "Gesuchte Gr√∂√üe: R (Widerstand)", options: ["œÅ ¬∑ l / A", "U ¬∑ I", "P ¬∑ t", "Q ¬∑ U"], a: 0 },
            { q: "Gesuchte Gr√∂√üe: E (Energie)", options: ["P ¬∑ t", "U / I", "R / t", "I / U"], a: 0 },
            { q: "Reihenschaltung: U_ges", options: ["U1 + U2", "U1 = U2", "U1 ¬∑ U2", "U1 / U2"], a: 0 },
            { q: "Parallelschaltung: I_ges", options: ["I1 + I2", "I1 = I2", "I1 ¬∑ I2", "I1 - I2"], a: 0 },
            { q: "Gesuchte Gr√∂√üe: I (Strom)", options: ["U / R", "R / U", "P ¬∑ U", "E ¬∑ t"], a: 0 },
            { q: "Formel f√ºr: P mit R und I", options: ["I¬≤ ¬∑ R", "U¬≤ ¬∑ R", "R / I", "I / R"], a: 0 },
            { q: "Formel f√ºr: P mit U und R", options: ["U¬≤ / R", "U ¬∑ R", "R / U", "U¬≤ ¬∑ I"], a: 0 },
            { q: "Formel f√ºr: I mit Q und t", options: ["Q / t", "Q ¬∑ t", "t / Q", "Q + t"], a: 0 },
            { q: "Formel f√ºr: U mit E und Q", options: ["E / Q", "E ¬∑ Q", "Q / E", "E + Q"], a: 0 },
            { q: "Reihenschaltung: R_ges", options: ["R1 + R2", "1/R1 + 1/R2", "R1 ¬∑ R2", "R1 / R2"], a: 0 },
            { q: "Parallelschaltung: U_ges", options: ["U1 = U2", "U1 + U2", "U1 / U2", "0"], a: 0 },
            { q: "Reihenschaltung: I_ges", options: ["I1 = I2", "I1 + I2", "I1 / I2", "I1 ¬∑ I2"], a: 0 },
            { q: "Einheit: Elektrische Ladung", options: ["Coulomb (As)", "Watt", "Volt", "Hertz"], a: 0 },
            { q: "Einheit: Spezifischer Widerstand", options: ["Œ© ¬∑ mm¬≤ / m", "Œ© / m", "A ¬∑ m", "V / m"], a: 0 },
            { q: "Berechnung: Zeit t aus I und Q", options: ["Q / I", "Q ¬∑ I", "I / Q", "Q¬≤"], a: 0 },
            { q: "Berechnung: R aus P und I", options: ["P / I¬≤", "P ¬∑ I", "I / P", "P¬≤"], a: 0 },
            { q: "Berechnung: U aus P und R", options: ["‚àö(P ¬∑ R)", "P ¬∑ R", "P / R", "R¬≤"], a: 0 },
            { q: "Symbol f√ºr Querschnitt", options: ["A", "Q", "d", "V"], a: 0 }
        ];

        const poolFill_de = [
            { q: "Das Ohmsche Gesetz lautet U = R ¬∑ ...", a: "I", hint: "Stromst√§rke" },
            { q: "Die Einheit der Spannung ist ...", a: "Volt", hint: "V" },
            { q: "Bei einer ...schaltung ist die Spannung √ºberall gleich.", a: "Parallel", hint: "Gegenteil von Reihe" },
            { q: "Elektrische Leistung P wird in der Einheit ... gemessen.", a: "Watt", hint: "James ..." },
            { q: "R = œÅ ¬∑ l / ...", a: "A", hint: "Querschnittsfl√§che" },
            { q: "In einer Reihenschaltung addieren sich die ...st√§nde.", a: "Wider", hint: "Wider..." },
            { q: "Formelzeichen f√ºr die Zeit ist ...", a: "t", hint: "Kleinbuchstabe" },
            { q: "Energie E = P ¬∑ ...", a: "t", hint: "Zeit" },
            { q: "Stromst√§rke I = ... / R", a: "U", hint: "Spannung" },
            { q: "Die Einheit f√ºr Widerstand ist ...", a: "Ohm", hint: "Œ©" },
            { q: "U_ges = U1 + U2 gilt f√ºr die ...schaltung.", a: "Reihen", hint: "Nicht parallel" },
            { q: "I_ges = I1 + I2 gilt f√ºr die ...schaltung.", a: "Parallel", hint: "Str√∂me teilen sich auf" },
            { q: "Das Formelzeichen f√ºr elektrische Arbeit ist ...", a: "E", hint: "Oder W (Energy)" },
            { q: "Spezifischer Widerstand wird mit dem Buchstaben ... abgek√ºrzt.", a: "Rho", hint: "Griechischer Buchstabe" },
            { q: "Die Ladung Q hat die Einheit ...", a: "Coulomb", hint: "Oder As" },
            { q: "Ein Voltmeter misst die ...", a: "Spannung", hint: "Gr√∂√üe U" },
            { q: "1000 Watt sind ein ...", a: "Kilowatt", hint: "kW" },
            { q: "P = U ¬∑ ...", a: "I", hint: "Strom" },
            { q: "R = U / ...", a: "I", hint: "Strom" },
            { q: "Wenn R steigt und U gleich bleibt, wird I ...", a: "kleiner", hint: "Sinkt oder steigt?" }
        ];

        // --- DATA POOL (ENGLISH) ---
        const poolMC_en = [
            { q: "What does Ohm's Law state?", options: ["U = R ¬∑ I", "U = R / I", "I = R ¬∑ U", "R = U ¬∑ I"], a: 0, hint: "Voltage = Resistance times Current." },
            { q: "Which symbol stands for electric charge?", options: ["Q", "C", "L", "I"], a: 0, hint: "Think of 'Quantity' or Coulomb." },
            { q: "In which unit is electrical resistance measured?", options: ["Ohm (Œ©)", "Volt (V)", "Ampere (A)", "Watt (W)"], a: 0, hint: "The symbol looks like a horseshoe." },
            { q: "What applies to current I in a series circuit?", options: ["Is the same everywhere", "Adds up", "Is zero", "Splits up"], a: 0, hint: "There is only one path for electrons." },
            { q: "How does voltage behave in a parallel circuit?", options: ["Is the same everywhere", "Adds up to total voltage", "Depends on resistance", "Is always 230V"], a: 0, hint: "All components are connected directly to the source." },
            { q: "The formula P = U ¬∑ I calculates which quantity?", options: ["Electric Power", "Electric Work", "Resistance", "Voltage"], a: 0, hint: "P stands for Power." },
            { q: "What is the unit of electrical energy?", options: ["Joule (Ws)", "Watt (W)", "Volt (V)", "Ampere (A)"], a: 0, hint: "Power times time." },
            { q: "How do you calculate total resistance in series?", options: ["R1 + R2", "1/R1 + 1/R2", "R1 ¬∑ R2", "R1 - R2"], a: 0, hint: "Just add them." },
            { q: "What does the symbol 'œÅ' (Rho) stand for?", options: ["Specific Resistance (Resistivity)", "Density", "Radius", "Power"], a: 0, hint: "Material constant for resistance." },
            { q: "Which quantity is measured in Ampere (A)?", options: ["Current", "Voltage", "Charge", "Energy"], a: 0, hint: "The flow of electrons." },
            { q: "What is the formula for resistance involving wire length?", options: ["R = œÅ ¬∑ l / A", "R = œÅ ¬∑ A / l", "R = l ¬∑ A / œÅ", "R = U / P"], a: 0, hint: "Longer = more resistance. Thicker = less resistance." },
            { q: "What happens to total resistance in parallel?", options: ["It becomes smaller than the smallest single resistor", "It adds up", "It doubles", "It stays the same"], a: 0, hint: "More paths mean easier flow." },
            { q: "The formula I = Q / t describes...", options: ["Current as charge per time", "Voltage as energy per charge", "Power as work per time", "Resistance"], a: 0, hint: "How many electrons flow per second?" },
            { q: "What is 1 kŒ© in Ohm?", options: ["1000 Œ©", "100 Œ©", "10 Œ©", "10000 Œ©"], a: 0, hint: "k stands for Kilo." },
            { q: "Which formula for power is correct?", options: ["P = I¬≤ ¬∑ R", "P = U / R", "P = R / I¬≤", "P = U ¬∑ R"], a: 0, hint: "Substitute U=R¬∑I into P=U¬∑I." },
            { q: "U = P / I is a rearrangement of...", options: ["Power formula", "Resistance formula", "Energy formula", "Charge formula"], a: 0, hint: "P = U ¬∑ I solved for U." },
            { q: "What does 't' stand for in the formulas?", options: ["Time", "Temperature", "Tone", "Tesla"], a: 0, hint: "Time (in seconds)." },
            { q: "What is the formula for electrical work?", options: ["E = P ¬∑ t", "E = U / t", "E = R ¬∑ I", "E = Q / U"], a: 0, hint: "Energy is power over time." },
            { q: "In a series circuit of two identical lamps...", options: ["Voltage splits between both", "Both shine brighter than one alone", "Different current flows", "Voltage is the same everywhere"], a: 0, hint: "U_total = U1 + U2." },
            { q: "The cross-section A of a conductor is given in...", options: ["mm¬≤", "m", "cm", "Œ©"], a: 0, hint: "It is an area." }
        ];

        const poolBool_en = [
            { q: "In a parallel circuit, the voltage is the same across all resistors.", a: true, hint: "U_total = U1 = U2" },
            { q: "The unit of electrical voltage is Watt.", a: false, hint: "Voltage is measured in Volts." },
            { q: "Total resistance in series is the sum of individual resistors.", a: true, hint: "R_total = R1 + R2 + ..." },
            { q: "Current is measured in Volts.", a: false, hint: "Ampere is correct." },
            { q: "Electrical work E is calculated as Power times Time.", a: true, hint: "E = P ¬∑ t" },
            { q: "A thicker wire (larger A) has a higher resistance.", a: false, hint: "More space for electrons = less resistance." },
            { q: "Copper has a specific resistance.", a: true, hint: "Every material conducts differently." },
            { q: "I = U / R is a form of Ohm's Law.", a: true, hint: "Yes, solved for I." },
            { q: "In a series circuit, currents add up.", a: false, hint: "Current must go through everywhere." },
            { q: "P = U¬≤ / R is a correct power formula.", a: true, hint: "Derived by substitution." },
            { q: "Electric charge has the symbol Q.", a: true, hint: "Correct." },
            { q: "If you increase voltage (with constant R), current decreases.", a: false, hint: "More pressure (U) = more flow (I)." },
            { q: "1 Watt-second (Ws) equals 1 Joule.", a: true, hint: "That is the definition." },
            { q: "The reciprocal of total resistance in parallel is the sum of reciprocals.", a: true, hint: "1/R_tot = 1/R1 + 1/R2" },
            { q: "Length of the conductor has no influence on resistance.", a: false, hint: "Longer means harder for electrons." },
            { q: "A voltmeter is always connected in series.", a: false, hint: "Voltage is measured in parallel." },
            { q: "An ammeter is connected in series.", a: true, hint: "Current must flow through the meter." },
            { q: "E = U ¬∑ Q is a formula for energy.", a: true, hint: "See cheat sheet." },
            { q: "Specific resistance is given in Œ©m or Œ©mm¬≤/m.", a: true, hint: "Material dependent." },
            { q: "Current flows even if the circuit is broken.", a: false, hint: "Logical, right?" }
        ];

        const poolMatch_en = [
            { q: "Find: U (Voltage)", options: ["R ¬∑ I", "P ¬∑ t", "Q / t", "œÅ ¬∑ l"], a: 0 },
            { q: "Find: P (Power)", options: ["U ¬∑ I", "U / I", "R ¬∑ t", "E / U"], a: 0 },
            { q: "Find: R (Resistance)", options: ["œÅ ¬∑ l / A", "U ¬∑ I", "P ¬∑ t", "Q ¬∑ U"], a: 0 },
            { q: "Find: E (Energy)", options: ["P ¬∑ t", "U / I", "R / t", "I / U"], a: 0 },
            { q: "Series: U_total", options: ["U1 + U2", "U1 = U2", "U1 ¬∑ U2", "U1 / U2"], a: 0 },
            { q: "Parallel: I_total", options: ["I1 + I2", "I1 = I2", "I1 ¬∑ I2", "I1 - I2"], a: 0 },
            { q: "Find: I (Current)", options: ["U / R", "R / U", "P ¬∑ U", "E ¬∑ t"], a: 0 },
            { q: "Formula: P using R and I", options: ["I¬≤ ¬∑ R", "U¬≤ ¬∑ R", "R / I", "I / R"], a: 0 },
            { q: "Formula: P using U and R", options: ["U¬≤ / R", "U ¬∑ R", "R / U", "U¬≤ ¬∑ I"], a: 0 },
            { q: "Formula: I using Q and t", options: ["Q / t", "Q ¬∑ t", "t / Q", "Q + t"], a: 0 },
            { q: "Formula: U using E and Q", options: ["E / Q", "E ¬∑ Q", "Q / E", "E + Q"], a: 0 },
            { q: "Series: R_total", options: ["R1 + R2", "1/R1 + 1/R2", "R1 ¬∑ R2", "R1 / R2"], a: 0 },
            { q: "Parallel: U_total", options: ["U1 = U2", "U1 + U2", "U1 / U2", "0"], a: 0 },
            { q: "Series: I_total", options: ["I1 = I2", "I1 + I2", "I1 / I2", "I1 ¬∑ I2"], a: 0 },
            { q: "Unit: Electric Charge", options: ["Coulomb (As)", "Watt", "Volt", "Hertz"], a: 0 },
            { q: "Unit: Specific Resistance", options: ["Œ© ¬∑ mm¬≤ / m", "Œ© / m", "A ¬∑ m", "V / m"], a: 0 },
            { q: "Calc: Time t from I and Q", options: ["Q / I", "Q ¬∑ I", "I / Q", "Q¬≤"], a: 0 },
            { q: "Calc: R from P and I", options: ["P / I¬≤", "P ¬∑ I", "I / P", "P¬≤"], a: 0 },
            { q: "Calc: U from P and R", options: ["‚àö(P ¬∑ R)", "P ¬∑ R", "P / R", "R¬≤"], a: 0 },
            { q: "Symbol for Cross-section", options: ["A", "Q", "d", "V"], a: 0 }
        ];

        const poolFill_en = [
            { q: "Ohm's Law states U = R ¬∑ ...", a: "I", hint: "Current" },
            { q: "The unit of voltage is ...", a: "Volt", hint: "V" },
            { q: "In a ... circuit, voltage is the same everywhere.", a: "Parallel", hint: "Opposite of series" },
            { q: "Electric Power P is measured in the unit ...", a: "Watt", hint: "James ..." },
            { q: "R = œÅ ¬∑ l / ...", a: "A", hint: "Cross-sectional area" },
            { q: "In a series circuit, resistances ...", a: "add", hint: "Sum up" },
            { q: "Symbol for time is ...", a: "t", hint: "Lowercase" },
            { q: "Energy E = P ¬∑ ...", a: "t", hint: "Time" },
            { q: "Current I = ... / R", a: "U", hint: "Voltage" },
            { q: "The unit for resistance is ...", a: "Ohm", hint: "Œ©" },
            { q: "U_total = U1 + U2 applies to the ... circuit.", a: "Series", hint: "Not parallel" },
            { q: "I_total = I1 + I2 applies to the ... circuit.", a: "Parallel", hint: "Currents split" },
            { q: "The symbol for electrical work is ...", a: "E", hint: "Or W (Energy)" },
            { q: "Specific resistance is abbreviated with the letter ...", a: "Rho", hint: "Greek letter" },
            { q: "Charge Q has the unit ...", a: "Coulomb", hint: "Or As" },
            { q: "A voltmeter measures ...", a: "Voltage", hint: "Quantity U" },
            { q: "1000 Watts is one ...", a: "Kilowatt", hint: "kW" },
            { q: "P = U ¬∑ ...", a: "I", hint: "Current" },
            { q: "R = U / ...", a: "I", hint: "Current" },
            { q: "If R increases and U stays same, I becomes ...", a: "smaller", hint: "Decreases" }
        ];


        // 5. COMPLEX CALCULATOR GENERATOR
        function generateMathProblem() {
            const types = ['ohm', 'power', 'series', 'parallel', 'wire', 'energy'];
            const type = types[Math.floor(Math.random() * types.length)];
            let qText = "", correctVal = 0, unit = "", hintText = "";
            const isEn = currentLang === 'en';

            const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
            const fix = (n) => parseFloat(n.toFixed(2));

            if (type === 'ohm') {
                const missing = Math.random() < 0.33 ? 'U' : (Math.random() < 0.5 ? 'R' : 'I');
                const R = rand(5, 100);
                const I = rand(1, 10);
                const U = R * I;
                
                if(missing === 'U') {
                    qText = isEn ? `Calculate voltage U, given R = ${R} Œ© and I = ${I} A.` : `Berechne die Spannung U, wenn R = ${R} Œ© und I = ${I} A.`;
                    correctVal = U; unit = "V"; hintText = "U = R ¬∑ I";
                } else if (missing === 'R') {
                    qText = isEn ? `Calculate resistance R, given U = ${U} V and I = ${I} A.` : `Berechne den Widerstand R, wenn U = ${U} V und I = ${I} A.`;
                    correctVal = R; unit = "Œ©"; hintText = "R = U / I";
                } else {
                    qText = isEn ? `Calculate current I, given U = ${U} V and R = ${R} Œ©.` : `Berechne die Stromst√§rke I, wenn U = ${U} V und R = ${R} Œ©.`;
                    correctVal = I; unit = "A"; hintText = "I = U / R";
                }
            } 
            else if (type === 'power') {
                const U = rand(10, 230);
                const I = rand(1, 5);
                const P = U * I;
                const R = rand(10, 50);
                
                const subType = Math.random();
                if(subType < 0.33) {
                    qText = isEn ? `A device uses current ${I} A at ${U} V. Calculate Power P.` : `Ein Ger√§t verbraucht bei ${U} V einen Strom von ${I} A. Berechne die Leistung P.`;
                    correctVal = P; unit = "W"; hintText = "P = U ¬∑ I";
                } else if (subType < 0.66) {
                    qText = isEn ? `A resistor of ${R} Œ© has ${I} A flowing through it. Calculate Power P.` : `Ein Widerstand von ${R} Œ© wird von ${I} A durchflossen. Berechne die Leistung P.`;
                    correctVal = I * I * R; unit = "W"; hintText = "P = I¬≤ ¬∑ R";
                } else {
                    qText = isEn ? `Device has 200 W power at 50 V. What is the resistance R?` : `Ein Ger√§t hat 200 W Leistung und l√§uft bei 50 V. Wie gro√ü ist der Widerstand R?`;
                    const uFix = 50; const pFix = 200;
                    correctVal = (uFix * uFix) / pFix; unit = "Œ©"; hintText = "R = U¬≤ / P";
                }
            }
            else if (type === 'series') {
                const r1 = rand(10, 50);
                const r2 = rand(10, 50);
                qText = isEn ? `Series circuit: R1 = ${r1} Œ©, R2 = ${r2} Œ©. Calculate total resistance.` : `Reihenschaltung: R1 = ${r1} Œ©, R2 = ${r2} Œ©. Berechne den Gesamtwiderstand.`;
                correctVal = r1 + r2; unit = "Œ©"; hintText = isEn ? "Just add them." : "Einfach addieren.";
            }
            else if (type === 'parallel') {
                const r1 = rand(10, 60);
                const r2 = rand(10, 60);
                qText = isEn ? `Parallel circuit: R1 = ${r1} Œ©, R2 = ${r2} Œ©. Calculate R_total (round to 2 decimals).` : `Parallelschaltung: R1 = ${r1} Œ©, R2 = ${r2} Œ©. Berechne R_ges (auf 2 Stellen runden).`;
                correctVal = (r1 * r2) / (r1 + r2);
                unit = "Œ©"; hintText = "R_ges = (R1 ¬∑ R2) / (R1 + R2)";
            }
            else if (type === 'wire') {
                const rho = 0.017;
                const l = rand(50, 500);
                const A = rand(1, 4);
                qText = isEn ? `Copper wire (œÅ ‚âà 0.017): Length l = ${l} m, Area A = ${A} mm¬≤. Calculate R.` : `Kupferdraht (œÅ ‚âà 0.017): L√§nge l = ${l} m, Querschnitt A = ${A} mm¬≤. Berechne R.`;
                correctVal = (rho * l) / A;
                unit = "Œ©"; hintText = "R = œÅ ¬∑ l / A";
            }
            else if (type === 'energy') {
                const P = rand(50, 2000);
                const t = rand(1, 10);
                qText = isEn ? `Device runs at ${P} Watts for ${t} hours. Calculate Energy in Wh.` : `Ein Ger√§t leistet ${P} Watt f√ºr ${t} Stunden. Berechne die Energie in Wattstunden (Wh).`;
                correctVal = P * t; unit = "Wh"; hintText = "E = P ¬∑ t";
            }

            return { q: qText, a: fix(correctVal), unit: unit, hint: hintText, type: 'calc' };
        }


        // --- APP LOGIC ---

        let currentMode = '';
        let quizQueue = [];
        let currentIndex = 0;
        let score = 0;

        function toggleMenu() {
            document.getElementById('side-menu').classList.toggle('open');
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }

        function toggleLang() {
            currentLang = currentLang === 'de' ? 'en' : 'de';
            const btn = document.getElementById('lang-btn');
            btn.innerText = currentLang === 'de' ? 'EN' : 'DE';
            
            // UI Texte updaten
            const txt = uiText[currentLang];
            document.getElementById('txt-brand').innerText = txt.brand;
            document.getElementById('txt-menu1').innerText = txt.menu1;
            document.getElementById('txt-menu2').innerText = txt.menu2;
            document.getElementById('btn-mc').innerText = txt.btnMC;
            document.getElementById('btn-bool').innerText = txt.btnBool;
            document.getElementById('btn-match').innerText = txt.btnMatch;
            document.getElementById('btn-fill').innerText = txt.btnFill;
            document.getElementById('btn-calc').innerText = txt.btnCalc;
            document.getElementById('search-input').placeholder = txt.search;
            document.getElementById('txt-welcome-head').innerText = txt.welcHead;
            document.getElementById('txt-welcome-body').innerText = txt.welcBody;
            document.getElementById('txt-topics').innerHTML = txt.topics;
            document.getElementById('hint-btn').innerText = txt.hint;
            document.getElementById('next-btn').innerText = txt.next;
            document.getElementById('check-btn').innerText = txt.check;
            document.getElementById('txt-res-head').innerText = txt.resHead;
            document.getElementById('btn-restart').innerText = txt.restart;

            // Laufendes Quiz abbrechen bei Sprachwechsel
            if(!document.getElementById('quiz-interface').classList.contains('hidden')){
                alert(currentLang === 'de' ? "Sprache ge√§ndert. Quiz wird neu gestartet." : "Language changed. Quiz will restart.");
                location.reload();
            }
        }

        function filterMenu() {
            const term = document.getElementById('search-input').value.toLowerCase();
            const btns = document.querySelectorAll('.menu-item');
            btns.forEach(btn => {
                const txt = btn.innerText.toLowerCase();
                btn.style.display = txt.includes(term) ? 'block' : 'none';
            });
        }

        function startQuiz(mode) {
            currentMode = mode;
            toggleMenu();
            
            score = 0;
            currentIndex = 0;
            
            if(mode === 'calc') {
                quizQueue = [];
                for(let i=0; i<20; i++) quizQueue.push(generateMathProblem());
                document.getElementById('quiz-category-label').innerText = currentLang === 'de' ? "Mathe-Profi (Schwer)" : "Math Pro (Hard)";
            } else {
                let source = [];
                let label = "";
                // W√§hle Pool basierend auf Sprache
                if(currentLang === 'de') {
                    if(mode === 'mc') { source = poolMC_de; label = "Multiple Choice"; }
                    if(mode === 'bool') { source = poolBool_de; label = "Ja / Nein"; }
                    if(mode === 'match') { source = poolMatch_de; label = "Formel Zuordnung"; }
                    if(mode === 'fill') { source = poolFill_de; label = "L√ºckentext"; }
                } else {
                    if(mode === 'mc') { source = poolMC_en; label = "Multiple Choice"; }
                    if(mode === 'bool') { source = poolBool_en; label = "True / False"; }
                    if(mode === 'match') { source = poolMatch_en; label = "Formula Match"; }
                    if(mode === 'fill') { source = poolFill_en; label = "Fill in the blank"; }
                }
                
                quizQueue = [...source].sort(() => 0.5 - Math.random()).slice(0, 20);
                document.getElementById('quiz-category-label').innerText = label;
            }

            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('quiz-interface').classList.remove('hidden');
            
            loadQuestion();
        }

        function loadQuestion() {
            const data = quizQueue[currentIndex];
            const qEl = document.getElementById('question-text');
            const area = document.getElementById('interaction-area');
            const feedback = document.getElementById('feedback');
            const nextBtn = document.getElementById('next-btn');
            const checkBtn = document.getElementById('check-btn');
            const hintBtn = document.getElementById('hint-btn');
            const txt = uiText[currentLang];

            feedback.style.display = 'none';
            feedback.className = 'feedback-box';
            area.innerHTML = '';
            nextBtn.classList.add('hidden');
            checkBtn.classList.add('hidden');
            hintBtn.disabled = false;
            qEl.innerText = data.q;

            const pct = (currentIndex / quizQueue.length) * 100;
            document.getElementById('progress-bar').style.width = pct + "%";

            if (currentMode === 'mc' || currentMode === 'match') {
                const grid = document.createElement('div');
                grid.className = 'options-grid';
                let indexedOptions = data.options.map((val, idx) => ({val, idx}));
                indexedOptions.sort(() => 0.5 - Math.random());

                indexedOptions.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'btn-option';
                    btn.innerText = opt.val;
                    btn.onclick = () => resolveChoice(btn, opt.idx === data.a, data.explanation || "");
                    grid.appendChild(btn);
                });
                area.appendChild(grid);

            } else if (currentMode === 'bool') {
                const grid = document.createElement('div');
                grid.className = 'options-grid';
                
                const btnYes = document.createElement('button');
                btnYes.className = 'btn-option';
                btnYes.innerText = txt.boolY;
                btnYes.onclick = () => resolveChoice(btnYes, data.a === true, "");

                const btnNo = document.createElement('button');
                btnNo.className = 'btn-option';
                btnNo.innerText = txt.boolN;
                btnNo.onclick = () => resolveChoice(btnNo, data.a === false, "");

                grid.appendChild(btnYes);
                grid.appendChild(btnNo);
                area.appendChild(grid);

            } else if (currentMode === 'fill' || currentMode === 'calc') {
                const input = document.createElement('input');
                input.type = currentMode === 'calc' ? 'number' : 'text';
                input.className = 'input-field';
                input.placeholder = currentMode === 'calc' ? txt.phNum : txt.phText;
                input.id = 'user-input';
                
                input.addEventListener("keypress", function(event) {
                    if (event.key === "Enter") checkInputAnswer();
                });

                area.appendChild(input);
                checkBtn.classList.remove('hidden');
            }
        }

        function resolveChoice(btnElement, isCorrect, explanation) {
            const btns = document.querySelectorAll('.btn-option');
            btns.forEach(b => b.disabled = true);

            const feedback = document.getElementById('feedback');
            const txt = uiText[currentLang];
            feedback.style.display = 'block';

            if (isCorrect) {
                score++;
                btnElement.classList.add('correct');
                feedback.innerHTML = `<span style="color:var(--success); font-weight:bold">${txt.correct}</span> ${explanation}`;
                feedback.style.border = "1px solid var(--success)";
                feedback.style.background = "rgba(39, 174, 96, 0.1)";
            } else {
                btnElement.classList.add('wrong');
                feedback.innerHTML = `<span style="color:var(--error); font-weight:bold">${txt.wrong}</span> ${explanation}`;
                feedback.style.border = "1px solid var(--error)";
                feedback.style.background = "rgba(192, 57, 43, 0.1)";
            }
            
            document.getElementById('next-btn').classList.remove('hidden');
            document.getElementById('hint-btn').disabled = true;
        }

        function checkInputAnswer() {
            const input = document.getElementById('user-input');
            const val = input.value.trim();
            if(!val) return;

            const data = quizQueue[currentIndex];
            const txt = uiText[currentLang];
            let isCorrect = false;

            if (currentMode === 'calc') {
                const numVal = parseFloat(val.replace(',', '.'));
                const correct = data.a;
                const tolerance = Math.max(0.1, correct * 0.05);
                if (Math.abs(numVal - correct) <= tolerance) isCorrect = true;
            } else {
                if (val.toLowerCase() === data.a.toLowerCase()) isCorrect = true;
            }

            const feedback = document.getElementById('feedback');
            feedback.style.display = 'block';
            input.disabled = true;
            document.getElementById('check-btn').classList.add('hidden');

            if(isCorrect) {
                score++;
                feedback.innerHTML = `<span style="color:var(--success); font-weight:bold">${txt.correct}</span>`;
                feedback.style.border = "1px solid var(--success)";
                feedback.style.background = "rgba(39, 174, 96, 0.1)";
            } else {
                feedback.innerHTML = `<span style="color:var(--error); font-weight:bold">${txt.wrong}</span> Solution: ${data.a} ${data.unit || ''}`;
                feedback.style.border = "1px solid var(--error)";
                feedback.style.background = "rgba(192, 57, 43, 0.1)";
            }

            document.getElementById('next-btn').classList.remove('hidden');
        }

        function showHint() {
            const data = quizQueue[currentIndex];
            const prefix = currentLang === 'de' ? "Tipp: " : "Hint: ";
            const noHint = currentLang === 'de' ? "Kein Tipp verf√ºgbar." : "No hint available.";
            alert(prefix + (data.hint || noHint));
        }

        function nextQuestion() {
            currentIndex++;
            if(currentIndex < quizQueue.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('quiz-interface').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            const pct = Math.round((score / quizQueue.length) * 100);
            document.getElementById('final-score').innerText = `${score} / ${quizQueue.length}`;
            
            const txt = uiText[currentLang];
            let msg = "";
            if(pct === 100) msg = txt.resMsg1;
            else if(pct >= 80) msg = txt.resMsg2;
            else if(pct >= 50) msg = txt.resMsg3;
            else msg = txt.resMsg4;
            
            document.getElementById('result-message').innerText = msg;
        }

    </script>
</body>
</html>
